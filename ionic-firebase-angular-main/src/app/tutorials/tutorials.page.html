<ion-header>
  <ion-toolbar>
    <ion-title>Tutoriales</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/party" color="medium">Eventos</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <section class="form">
    <form [formGroup]="tutorialForm" (ngSubmit)="createTutorial()">
      <ion-list lines="none">
        <ion-item>
          <ion-label position="stacked">Título</ion-label>
          <ion-input
            formControlName="title"
            autocomplete="off"
            required
            placeholder="Ingresa el título"
          ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Descripción</ion-label>
          <ion-textarea
            formControlName="description"
            autoGrow="true"
            placeholder="Describe brevemente el tutorial"
          ></ion-textarea>
        </ion-item>
      </ion-list>
      <ion-button
        type="submit"
        expand="block"
        class="ion-margin-top"
        [disabled]="tutorialForm.invalid || loading()"
      >
        Crear tutorial
      </ion-button>
    </form>
  </section>

  @if (error(); as errorMessage) {
    <ion-note color="danger" class="error-message">
      {{ errorMessage }}
    </ion-note>
  }

  @if (loading()) {
    <div class="loading">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  }

  <ion-list>
    @if (tutorials().length === 0 && !loading()) {
      <ion-item lines="full">
        <ion-label>No hay tutoriales registrados.</ion-label>
      </ion-item>
    }

    @for (tutorial of tutorials(); track trackByTutorialId) {
      <ion-card>
        <ion-card-header>
          <div class="card-header">
            <ion-card-title>{{ tutorial.title }}</ion-card-title>
            <ion-badge [color]="tutorial.published ? 'success' : 'medium'">
              {{ tutorial.published ? 'Publicado' : 'Borrador' }}
            </ion-badge>
          </div>
        </ion-card-header>
        <ion-card-content>
          <p class="description">
            {{ tutorial.description || 'Sin descripción disponible.' }}
          </p>
          <div class="actions">
            <ion-button
              size="small"
              fill="outline"
              color="primary"
              (click)="togglePublished(tutorial)"
            >
              {{ tutorial.published ? 'Marcar como borrador' : 'Publicar' }}
            </ion-button>
            <ion-button
              size="small"
              fill="outline"
              color="danger"
              (click)="removeTutorial(tutorial)"
            >
              Eliminar
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    }
  </ion-list>
</ion-content>
